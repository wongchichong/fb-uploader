{"version":3,"file":"Chalkee.cjs","sources":["../../src/core/Chalkee.ts"],"sourcesContent":["import { createStyleState, styleStateToAnsi, createReset, applyStyle } from './styler'\r\nimport { attachSpecialBgMethods } from './utils'\r\nimport { ChalkeeBase } from './ChalkeeBase'\r\nimport { StyleChainState } from '../types'\r\n\r\n/**\r\n * A function that styles text and can be chained with other styles\r\n * Supports multiple calling patterns:\r\n * 1. Regular function call: red('text')\r\n * 2. Template literal: red`text`\r\n * 3. Curried function calls: red('text')(value)(value2)\r\n */\r\ninterface StyledFunction {\r\n    (text: string): Chalkee\r\n    (strings: TemplateStringsArray, ...values: unknown[]): Chalkee\r\n    (...args: any[]): Chalkee\r\n}\r\n\r\nexport class Chalkee extends ChalkeeBase {\r\n    constructor(state?: any, text: string = '') {\r\n        super()\r\n        this._state = state || createStyleState()\r\n        if (text) {\r\n            const ansiCodes = styleStateToAnsi(this._state)\r\n            const reset = createReset()\r\n            this._accumulatedText = ansiCodes + text + reset\r\n        } else {\r\n            this._accumulatedText = ''\r\n        }\r\n\r\n        // Create a function that will be returned\r\n        const fn: any = function (...args: any[]) {\r\n            // Handle different call patterns\r\n            if (args.length === 1 && typeof args[0] === 'string') {\r\n                // For chaining with text, apply styling to this text and combine with accumulated text\r\n                const newText = args[0]\r\n                const newInstance = new Chalkee(fn._state, '')\r\n                const styledNewText = applyStyleWithCodes(newText, fn._state)\r\n                newInstance._accumulatedText = fn._accumulatedText + styledNewText\r\n                preserveBgMode(newInstance, fn)\r\n                return newInstance\r\n            } else if (args.length === 0) {\r\n                // Return self for chaining\r\n                return fn\r\n            } else if (args.length >= 1 && Array.isArray(args[0]) && typeof args[0][0] === 'string' && 'raw' in args[0]) {\r\n                // Handle template literals with interpolated values\r\n                const templateStrings = args[0] as TemplateStringsArray\r\n                const values = args.slice(1)\r\n\r\n                // Interpolate the template strings with values\r\n                let combinedText = templateStrings[0]\r\n                for (let i = 0; i < values.length; i++) {\r\n                    combinedText += String(values[i]) + (templateStrings[i + 1] || '')\r\n                }\r\n\r\n                const newInstance = new Chalkee(fn._state, '')\r\n                const styledCombinedText = applyStyleWithCodes(combinedText, fn._state)\r\n                newInstance._accumulatedText = fn._accumulatedText + styledCombinedText\r\n                preserveBgMode(newInstance, fn)\r\n                return newInstance\r\n            } else {\r\n                // Handle other cases\r\n                const combined = args.map(arg => String(arg)).join('')\r\n                const newInstance = new Chalkee(fn._state, '')\r\n                const styledCombinedText = applyStyleWithCodes(combined, fn._state)\r\n                newInstance._accumulatedText = fn._accumulatedText + styledCombinedText\r\n                preserveBgMode(newInstance, fn)\r\n                return newInstance\r\n            }\r\n        }\r\n\r\n        // Set the prototype to make methods available\r\n        Object.setPrototypeOf(fn, Chalkee.prototype)\r\n\r\n        // Define custom inspect symbol directly on the function instance\r\n        // This is a workaround for the test runner environment\r\n        const customInspectSymbol = Symbol.for('nodejs.util.inspect.custom')\r\n        Object.defineProperty(fn, customInspectSymbol, {\r\n            value: function (depth?: number, options?: any, inspect?: any): string {\r\n                // If noColor is enabled, strip ANSI codes from accumulated text\r\n                if (ChalkeeBase.noColor) {\r\n                    return this._accumulatedText.replace(/\\x1b\\[[0-9;]*m/g, '')\r\n                }\r\n                return this._accumulatedText\r\n            },\r\n            writable: true,\r\n            enumerable: false,\r\n            configurable: true\r\n        })\r\n\r\n        // Set properties on the function object\r\n        fn._state = this._state\r\n        fn._accumulatedText = this._accumulatedText\r\n\r\n        // Return the function instead of the class instance\r\n        return fn as any\r\n    }\r\n\r\n    // Main call method for when used as a function\r\n    call(text: string): Chalkee\r\n    call(strings: TemplateStringsArray, ...values: unknown[]): Chalkee\r\n    call(...args: any[]): Chalkee\r\n    call(...args: any[]): Chalkee {\r\n        // call<T, A extends any[], R>(this: (this: T, ...args: A) => R, thisArg: T, ...args: A): R {\r\n        if (args.length === 1 && typeof args[0] === 'string') {\r\n            // For chaining with text, apply styling to this text and combine with accumulated text\r\n            const newText = args[0]\r\n            const newInstance = new Chalkee(this._state, '')\r\n            const styledNewText = applyStyleWithCodes(newText, this._state)\r\n            newInstance._accumulatedText = this._accumulatedText + styledNewText\r\n            return newInstance\r\n        } else if (args.length === 0) {\r\n            // Return self for chaining\r\n            return this\r\n        } else {\r\n            // Handle other cases\r\n            const combined = args.map(arg => String(arg)).join('')\r\n            const newInstance = new Chalkee(this._state, '')\r\n            const styledCombinedText = applyStyleWithCodes(combined, this._state)\r\n            newInstance._accumulatedText = this._accumulatedText + styledCombinedText\r\n            return newInstance\r\n        }\r\n    }\r\n}\r\n\r\n// Ambient declaration merging to satisfy StyledFunction interface\r\n// The actual implementation is provided by the returned function from the constructor\r\nexport interface Chalkee extends StyledFunction { }\r\n\r\n// Helper: Preserve background mode flag and attach methods if needed\r\nfunction preserveBgMode(instance: any, sourceFn: any) {\r\n    if (sourceFn._isInBgMode) {\r\n        (instance as any)._isInBgMode = true\r\n        attachSpecialBgMethods(instance)\r\n    }\r\n}\r\n\r\n// Helper: Apply style with proper ANSI codes\r\nfunction applyStyleWithCodes(text: string, state: StyleChainState): string {\r\n    return applyStyle(text, state)\r\n}\r\n\r\n// Factory function to create a callable Chalkee instance\r\n// Following user's requirement: \"@template-handler.ts 203-238 only new Chalkee() here.... all these code should be in the class\"\r\nfunction createCallableChalkee(state: StyleChainState, text: string = ''): Chalkee {\r\n    return new Chalkee(state, text) //as ChalkeeBase & StyledFunction\r\n}\r\n\r\n// Factory function to create the initial styled function\r\nexport function createStyledFunction(text: string, state: StyleChainState) {\r\n    return createCallableChalkee(state, text)\r\n}"],"names":["Chalkee","ChalkeeBase","state","text","createStyleState","ansiCodes","styleStateToAnsi","reset","createReset","fn","args","newText","newInstance","styledNewText","applyStyleWithCodes","preserveBgMode","templateStrings","values","combinedText","i","styledCombinedText","combined","arg","customInspectSymbol","depth","options","inspect","instance","sourceFn","attachSpecialBgMethods","applyStyle","createCallableChalkee","createStyledFunction"],"mappings":"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"}
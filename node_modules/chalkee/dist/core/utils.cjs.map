{"version":3,"file":"utils.cjs","sources":["../../src/core/utils.ts"],"sourcesContent":["import { getColor, parseHex, rgbToAnsi256 } from './registry'\r\nimport { createStyleState } from \"./styler\"\r\nimport { mergeStyleStates } from './styler'\r\nimport { ChalkeeBase } from './ChalkeeBase'\r\n\r\n// Extend the ChalkeeBase interface with utility methods\r\ndeclare module './ChalkeeBase' {\r\n    interface ChalkeeBase {\r\n        createBgColor(colorName: string): ChalkeeBase\r\n        createReset(): ChalkeeBase\r\n        createAutoSpacing(): ChalkeeBase\r\n        createHexColor(color: string): ChalkeeBase\r\n        createRgbColor(r: number, g: number, b: number): ChalkeeBase\r\n        createBgHexColor(color: string): ChalkeeBase\r\n        createBgRgbColor(r: number, g: number, b: number): ChalkeeBase\r\n    }\r\n}\r\n\r\n// Attach utility methods to ChalkeeBase prototype\r\nfunction attachUtilMethods(ChalkeeBase: any) {\r\n    // Background color creator\r\n    Object.defineProperty(ChalkeeBase.prototype, 'createBgColor', {\r\n        value: function createBgColor(this: typeof ChalkeeBase, colorName: string): ChalkeeBase {\r\n            const currentState = this._state || createStyleState()\r\n            const colorDef = getColor(colorName)\r\n            if (!colorDef) {\r\n                return this as any as ChalkeeBase\r\n            }\r\n\r\n            const newState = mergeStyleStates(currentState, {\r\n                ...createStyleState(),\r\n                backgroundColors: [colorDef],\r\n                isOpen: true,\r\n                autoSpacing: currentState.autoSpacing || false\r\n            })\r\n            const newInstance = new (this.constructor as any)(newState, '')\r\n            newInstance._accumulatedText = this._accumulatedText\r\n            return newInstance as any as ChalkeeBase\r\n        },\r\n        writable: true,\r\n        enumerable: false,\r\n        configurable: true\r\n    })\r\n\r\n    // Background color replacement creator (for .bg mode)\r\n    Object.defineProperty(ChalkeeBase.prototype, 'createBgReplace', {\r\n        value: function createBgReplace(this: typeof ChalkeeBase, colorName: string): ChalkeeBase {\r\n            const currentState = this._state || createStyleState()\r\n            const colorDef = getColor(colorName)\r\n            if (!colorDef) {\r\n                return this as any as ChalkeeBase\r\n            }\r\n\r\n            // For .bg mode, we want to replace the background color, not add to it\r\n            // We also want a clean state without previous foreground colors or modifiers\r\n            const newState = {\r\n                ...createStyleState(), // Start with a clean state\r\n                backgroundColors: [colorDef], // Set only the new background color\r\n                isOpen: true,\r\n                autoSpacing: currentState.autoSpacing || false,\r\n                previousStyles: currentState // Use the current state as the previous styles\r\n            }\r\n            const newInstance = new (this.constructor as any)(newState, '')\r\n            newInstance._accumulatedText = (this as any)._accumulatedText || '';\r\n            // Preserve background mode flag\r\n            (newInstance as any)._isInBgMode = true\r\n\r\n            // ALSO attach special color methods to this instance for continued .bg mode chaining\r\n            attachSpecialBgMethods(newInstance)\r\n\r\n            return newInstance as any as ChalkeeBase\r\n        },\r\n        writable: true,\r\n        enumerable: false,\r\n        configurable: true\r\n    })\r\n\r\n    // Reset creator\r\n    Object.defineProperty(ChalkeeBase.prototype, 'createReset', {\r\n        value: function createReset(this: typeof ChalkeeBase): ChalkeeBase {\r\n            const currentState = this._state || createStyleState()\r\n            // For reset, we want to completely clear all styles, not merge them\r\n            const newState = {\r\n                ...createStyleState(),\r\n                colors: [],\r\n                modifiers: [],\r\n                backgroundColors: [],\r\n                isOpen: false,\r\n                autoSpacing: currentState.autoSpacing || false\r\n            }\r\n            const newInstance = new (this.constructor as any)(newState, '')\r\n            newInstance._accumulatedText = this._accumulatedText\r\n            return newInstance as any as ChalkeeBase\r\n        },\r\n        writable: true,\r\n        enumerable: false,\r\n        configurable: true\r\n    })\r\n\r\n    // Auto-spacing creator\r\n    Object.defineProperty(ChalkeeBase.prototype, 'createAutoSpacing', {\r\n        value: function createAutoSpacing(this: typeof ChalkeeBase): ChalkeeBase {\r\n            const currentState = this._state || createStyleState()\r\n            const newState = mergeStyleStates(currentState, {\r\n                ...createStyleState(),\r\n                isOpen: true,\r\n                autoSpacing: true\r\n            })\r\n            const newInstance = new (this.constructor as any)(newState, '')\r\n            newInstance._accumulatedText = this._accumulatedText\r\n            // Preserve background mode flag if present\r\n            if ((this as any)._isInBgMode) {\r\n                (newInstance as any)._isInBgMode = true\r\n            }\r\n            // Attach special bg methods to enable .bg chaining from .as\r\n            Object.defineProperty(newInstance, 'bg', {\r\n                get: function () {\r\n                    const bgInstance = newInstance.createBgMode()\r\n                    // Attach special color methods for .bg mode chaining\r\n                    attachSpecialBgMethods(bgInstance)\r\n                    return bgInstance\r\n                },\r\n                enumerable: true,\r\n                configurable: true\r\n            })\r\n            return newInstance as any as ChalkeeBase\r\n        },\r\n        writable: true,\r\n        enumerable: false,\r\n        configurable: true\r\n    })\r\n\r\n    // Background mode creator\r\n    Object.defineProperty(ChalkeeBase.prototype, 'createBgMode', {\r\n        value: function createBgMode(this: typeof ChalkeeBase): ChalkeeBase {\r\n            const currentState = (this as any)._state || createStyleState()\r\n            // Create a new instance that merges with existing state\r\n            const newState = mergeStyleStates(currentState, {\r\n                ...createStyleState(),\r\n                isOpen: true,\r\n                autoSpacing: currentState.autoSpacing || false\r\n            })\r\n            const newInstance = new (this.constructor as any)(newState, '')\r\n            newInstance._accumulatedText = (this as any)._accumulatedText || '';\r\n            // Add a flag to indicate we're in background mode\r\n            (newInstance as any)._isInBgMode = true\r\n            return newInstance as any as ChalkeeBase\r\n        },\r\n        writable: true,\r\n        enumerable: false,\r\n        configurable: true\r\n    })\r\n    // Hex color creator\r\n    Object.defineProperty(ChalkeeBase.prototype, 'createHexColor', {\r\n        value: function createHexColor(this: typeof ChalkeeBase, color: string): ChalkeeBase {\r\n            const currentState = this._state || createStyleState()\r\n\r\n            // Parse hex color\r\n            const hexCode = parseHex(color)\r\n            if (!hexCode) {\r\n                return this as any as ChalkeeBase\r\n            }\r\n\r\n            const [r, g, b] = hexCode\r\n            const ansi256 = rgbToAnsi256(r, g, b)\r\n\r\n            // Create state with the hex color code\r\n            const newState = mergeStyleStates(currentState, {\r\n                ...createStyleState(),\r\n                isOpen: true,\r\n                autoSpacing: currentState.autoSpacing || false,\r\n                hexColorCode: `\\x1b[38;5;${ansi256}m` as any\r\n            })\r\n            const newInstance = new (this.constructor as any)(newState, '')\r\n            newInstance._accumulatedText = this._accumulatedText\r\n\r\n            return newInstance as any as ChalkeeBase\r\n        },\r\n        writable: true,\r\n        enumerable: false,\r\n        configurable: true\r\n    })\r\n\r\n    // RGB color creator\r\n    Object.defineProperty(ChalkeeBase.prototype, 'createRgbColor', {\r\n        value: function createRgbColor(this: typeof ChalkeeBase, r: number, g: number, b: number): ChalkeeBase {\r\n            const currentState = this._state || createStyleState()\r\n\r\n            // Convert RGB to ANSI 256 color\r\n            const ansi256 = rgbToAnsi256(r, g, b)\r\n\r\n            // Create state with the RGB color code\r\n            const newState = mergeStyleStates(currentState, {\r\n                ...createStyleState(),\r\n                isOpen: true,\r\n                autoSpacing: currentState.autoSpacing || false,\r\n                rgbColorCode: `\\x1b[38;5;${ansi256}m` as any\r\n            })\r\n            const newInstance = new (this.constructor as any)(newState, '')\r\n            newInstance._accumulatedText = this._accumulatedText\r\n\r\n            return newInstance as any as ChalkeeBase\r\n        },\r\n        writable: true,\r\n        enumerable: false,\r\n        configurable: true\r\n    })\r\n\r\n    // Background hex color creator\r\n    Object.defineProperty(ChalkeeBase.prototype, 'createBgHexColor', {\r\n        value: function createBgHexColor(this: typeof ChalkeeBase, color: string): ChalkeeBase {\r\n            const currentState = this._state || createStyleState()\r\n\r\n            // Parse hex color\r\n            const hexCode = parseHex(color)\r\n            if (!hexCode) {\r\n                return this as any as ChalkeeBase\r\n            }\r\n\r\n            const [r, g, b] = hexCode\r\n            const ansi256 = rgbToAnsi256(r, g, b)\r\n\r\n            // Create state with the background hex color code\r\n            const newState = mergeStyleStates(currentState, {\r\n                ...createStyleState(),\r\n                isOpen: true,\r\n                autoSpacing: currentState.autoSpacing || false,\r\n                bgHexColorCode: `\\x1b[48;5;${ansi256}m` as any\r\n            })\r\n            const newInstance = new (this.constructor as any)(newState, '')\r\n            newInstance._accumulatedText = this._accumulatedText\r\n\r\n            return newInstance as any as ChalkeeBase\r\n        },\r\n        writable: true,\r\n        enumerable: false,\r\n        configurable: true\r\n    })\r\n\r\n    // Background RGB color creator\r\n    Object.defineProperty(ChalkeeBase.prototype, 'createBgRgbColor', {\r\n        value: function createBgRgbColor(this: typeof ChalkeeBase, r: number, g: number, b: number): ChalkeeBase {\r\n            const currentState = this._state || createStyleState()\r\n\r\n            // Convert RGB to ANSI 256 color\r\n            const ansi256 = rgbToAnsi256(r, g, b)\r\n\r\n            // Create state with the background RGB color code\r\n            const newState = mergeStyleStates(currentState, {\r\n                ...createStyleState(),\r\n                isOpen: true,\r\n                autoSpacing: currentState.autoSpacing || false,\r\n                bgRgbColorCode: `\\x1b[48;5;${ansi256}m` as any\r\n            })\r\n            const newInstance = new (this.constructor as any)(newState, '')\r\n            newInstance._accumulatedText = this._accumulatedText\r\n\r\n            return newInstance as any as ChalkeeBase\r\n        },\r\n        writable: true,\r\n        enumerable: false,\r\n        configurable: true\r\n    })\r\n}\r\n\r\n// Helper function to attach special color methods for .bg mode\r\n// Pre-create property descriptors to avoid recreating them for each instance\r\nconst BG_PROPERTY_DESCRIPTORS: Record<string, PropertyDescriptor> = {}\r\n\r\nfunction createBgPropertyDescriptor(colorName: string, bgColorName: string): PropertyDescriptor {\r\n    const key = `${colorName}_${bgColorName}`\r\n    if (BG_PROPERTY_DESCRIPTORS[key]) {\r\n        return BG_PROPERTY_DESCRIPTORS[key]\r\n    }\r\n\r\n    const descriptor: PropertyDescriptor = {\r\n        get(this: any) {\r\n            return this.createBgReplace(bgColorName)\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    }\r\n\r\n    BG_PROPERTY_DESCRIPTORS[key] = descriptor\r\n    return descriptor\r\n}\r\n\r\nfunction attachSpecialBgMethods(instance: any) {\r\n    // Attach all foreground color methods to this instance to enable chaining\r\n    const colorMap: Record<string, string> = {\r\n        red: 'bgRed',\r\n        green: 'bgGreen',\r\n        blue: 'bgBlue',\r\n        yellow: 'bgYellow',\r\n        magenta: 'bgMagenta',\r\n        cyan: 'bgCyan',\r\n        white: 'bgWhite',\r\n        black: 'bgBlack',\r\n        gray: 'bgBlackBright',\r\n        grey: 'bgBlackBright',\r\n        redBright: 'bgRedBright',\r\n        greenBright: 'bgGreenBright',\r\n        blueBright: 'bgBlueBright',\r\n        yellowBright: 'bgYellowBright',\r\n        magentaBright: 'bgMagentaBright',\r\n        cyanBright: 'bgCyanBright',\r\n        whiteBright: 'bgWhiteBright',\r\n        blackBright: 'bgBlackBright'\r\n    }\r\n\r\n    // Reuse cached descriptors for performance\r\n    for (const [colorName, bgColorName] of Object.entries(colorMap)) {\r\n        const descriptor = createBgPropertyDescriptor(colorName, bgColorName)\r\n        Object.defineProperty(instance, colorName, descriptor)\r\n    }\r\n}\r\n\r\n// Automatically attach the methods when this module is imported\r\nattachUtilMethods(ChalkeeBase)\r\n\r\nexport { attachSpecialBgMethods }"],"names":["attachUtilMethods","ChalkeeBase","colorName","currentState","createStyleState","colorDef","getColor","newState","mergeStyleStates","newInstance","attachSpecialBgMethods","bgInstance","color","hexCode","parseHex","r","g","b","ansi256","rgbToAnsi256","BG_PROPERTY_DESCRIPTORS","createBgPropertyDescriptor","bgColorName","key","descriptor","instance","colorMap"],"mappings":"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"}
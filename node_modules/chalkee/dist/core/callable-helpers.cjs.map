{"version":3,"file":"callable-helpers.cjs","sources":["../../src/core/callable-helpers.ts"],"sourcesContent":["import { createStyleState } from \"./styler\"\r\nimport { getColor } from './registry'\r\nimport { mergeStyleStates, applyStyle } from './styler'\r\nimport { ChalkeeBase } from './ChalkeeBase'\r\n\r\n// Property descriptors cache to avoid recreating them\r\nconst propertyDescriptorCache: Record<string, PropertyDescriptor> = {}\r\n\r\nfunction getCachedPropertyDescriptor(key: string, getter: () => PropertyDescriptor): PropertyDescriptor {\r\n    if (!propertyDescriptorCache[key]) {\r\n        propertyDescriptorCache[key] = getter()\r\n    }\r\n    return propertyDescriptorCache[key]\r\n}\r\n\r\n// Create color descriptor once and reuse\r\nconst createColorDescriptor = getCachedPropertyDescriptor('createColor', () => ({\r\n    value: function createColor(this: ChalkeeBase, colorName: string, text?: string): ChalkeeBase {\r\n        const currentState = this._state || createStyleState()\r\n        const isInBgMode = !!this._isInBgMode\r\n\r\n        if (isInBgMode) {\r\n            const bgColorName = `bg${colorName.charAt(0).toUpperCase()}${colorName.slice(1)}`\r\n            const colorDef = getColor(bgColorName)\r\n            if (colorDef) {\r\n                const newState = {\r\n                    ...currentState,\r\n                    backgroundColors: [colorDef],\r\n                    isOpen: true,\r\n                    autoSpacing: currentState.autoSpacing || false\r\n                }\r\n\r\n                if (text !== undefined) {\r\n                    const newInstance = new (this.constructor as any)(newState, '')\r\n                    const styledText = applyStyle(text, newState)\r\n                    newInstance._accumulatedText = (this as any)._accumulatedText + styledText;\r\n                    (newInstance as any)._isInBgMode = true\r\n                    return newInstance as any as ChalkeeBase\r\n                } else {\r\n                    const newInstance: ChalkeeBase = new (this.constructor as any)(newState, '')\r\n                    newInstance._accumulatedText = this._accumulatedText\r\n                    newInstance._isInBgMode = true\r\n                    return newInstance\r\n                }\r\n            }\r\n        }\r\n\r\n        const newState = mergeStyleStates(currentState, {\r\n            ...createStyleState(),\r\n            colors: [getColor(colorName)!],\r\n            isOpen: true,\r\n            autoSpacing: currentState.autoSpacing || false\r\n        })\r\n\r\n        if (text !== undefined) {\r\n            const newInstance: ChalkeeBase = new (this.constructor as any)(newState, '')\r\n            const styledText = applyStyle(text, newState)\r\n            newInstance._accumulatedText = this._accumulatedText + styledText\r\n            return newInstance\r\n        } else {\r\n            const newInstance: ChalkeeBase = new (this.constructor as any)(newState, '')\r\n            newInstance._accumulatedText = this._accumulatedText\r\n            return newInstance\r\n        }\r\n    },\r\n    writable: true,\r\n    enumerable: false,\r\n    configurable: true\r\n}))\r\n\r\nObject.defineProperty(ChalkeeBase.prototype, 'createColor', createColorDescriptor)\r\n\r\nconst createModifierDescriptor = getCachedPropertyDescriptor('createModifier', () => ({\r\n    value: function createModifier(this: ChalkeeBase, modifier: string): ChalkeeBase {\r\n        const currentState = this._state || createStyleState()\r\n        const newState = mergeStyleStates(currentState, {\r\n            ...createStyleState(),\r\n            modifiers: [...(currentState.modifiers || []), modifier],\r\n            isOpen: true,\r\n            autoSpacing: currentState.autoSpacing || false\r\n        })\r\n        const newInstance = new (this.constructor as any)(newState, '')\r\n        newInstance._accumulatedText = (this as any)._accumulatedText\r\n        return newInstance as any as ChalkeeBase\r\n    },\r\n    writable: true,\r\n    enumerable: false,\r\n    configurable: true\r\n}))\r\n\r\nObject.defineProperty(ChalkeeBase.prototype, 'createModifier', createModifierDescriptor)\r\n\r\ndeclare module './ChalkeeBase' {\r\n    interface ChalkeeBase {\r\n        createColor(colorName: string, text?: string): ChalkeeBase\r\n        createModifier(modifier: string): ChalkeeBase\r\n        createBgMode(): ChalkeeBase\r\n    }\r\n}"],"names":["propertyDescriptorCache","getCachedPropertyDescriptor","key","getter","createColorDescriptor","colorName","text","currentState","createStyleState","bgColorName","colorDef","getColor","newState","newInstance","styledText","applyStyle","mergeStyleStates","ChalkeeBase","createModifierDescriptor","modifier"],"mappings":"wGAMMA,EAA8D,CAAA,EAEpE,SAASC,EAA4BC,EAAaC,EAAsD,CACpG,OAAKH,EAAwBE,CAAG,IAC5BF,EAAwBE,CAAG,EAAIC,EAAA,GAE5BH,EAAwBE,CAAG,CACtC,CAGA,MAAME,EAAwBH,EAA4B,cAAe,KAAO,CAC5E,MAAO,SAAwCI,EAAmBC,EAA4B,CAC1F,MAAMC,EAAe,KAAK,QAAUC,mBAAA,EAGpC,GAFmB,CAAC,CAAC,KAAK,YAEV,CACZ,MAAMC,EAAc,KAAKJ,EAAU,OAAO,CAAC,EAAE,YAAA,CAAa,GAAGA,EAAU,MAAM,CAAC,CAAC,GACzEK,EAAWC,EAAAA,SAASF,CAAW,EACrC,GAAIC,EAAU,CACV,MAAME,EAAW,CACb,GAAGL,EACH,iBAAkB,CAACG,CAAQ,EAC3B,OAAQ,GACR,YAAaH,EAAa,aAAe,EAAA,EAG7C,GAAID,IAAS,OAAW,CACpB,MAAMO,EAAc,IAAK,KAAK,YAAoBD,EAAU,EAAE,EACxDE,EAAaC,EAAAA,WAAWT,EAAMM,CAAQ,EAC5C,OAAAC,EAAY,iBAAoB,KAAa,iBAAmBC,EAC/DD,EAAoB,YAAc,GAC5BA,CACX,KAAO,CACH,MAAMA,EAA2B,IAAK,KAAK,YAAoBD,EAAU,EAAE,EAC3E,OAAAC,EAAY,iBAAmB,KAAK,iBACpCA,EAAY,YAAc,GACnBA,CACX,CACJ,CACJ,CAEA,MAAMD,EAAWI,EAAAA,iBAAiBT,EAAc,CAC5C,GAAGC,mBAAA,EACH,OAAQ,CAACG,WAASN,CAAS,CAAE,EAC7B,OAAQ,GACR,YAAaE,EAAa,aAAe,EAAA,CAC5C,EAED,GAAID,IAAS,OAAW,CACpB,MAAMO,EAA2B,IAAK,KAAK,YAAoBD,EAAU,EAAE,EACrEE,EAAaC,EAAAA,WAAWT,EAAMM,CAAQ,EAC5C,OAAAC,EAAY,iBAAmB,KAAK,iBAAmBC,EAChDD,CACX,KAAO,CACH,MAAMA,EAA2B,IAAK,KAAK,YAAoBD,EAAU,EAAE,EAC3E,OAAAC,EAAY,iBAAmB,KAAK,iBAC7BA,CACX,CACJ,EACA,SAAU,GACV,WAAY,GACZ,aAAc,EAClB,EAAE,EAEF,OAAO,eAAeI,EAAAA,YAAY,UAAW,cAAeb,CAAqB,EAEjF,MAAMc,EAA2BjB,EAA4B,iBAAkB,KAAO,CAClF,MAAO,SAA2CkB,EAA+B,CAC7E,MAAMZ,EAAe,KAAK,QAAUC,mBAAA,EAC9BI,EAAWI,EAAAA,iBAAiBT,EAAc,CAC5C,GAAGC,mBAAA,EACH,UAAW,CAAC,GAAID,EAAa,WAAa,CAAA,EAAKY,CAAQ,EACvD,OAAQ,GACR,YAAaZ,EAAa,aAAe,EAAA,CAC5C,EACKM,EAAc,IAAK,KAAK,YAAoBD,EAAU,EAAE,EAC9D,OAAAC,EAAY,iBAAoB,KAAa,iBACtCA,CACX,EACA,SAAU,GACV,WAAY,GACZ,aAAc,EAClB,EAAE,EAEF,OAAO,eAAeI,EAAAA,YAAY,UAAW,iBAAkBC,CAAwB"}
{"version":3,"file":"callable-helpers.mjs","sources":["../../src/core/callable-helpers.ts"],"sourcesContent":["import { createStyleState } from \"./styler\"\r\nimport { getColor } from './registry'\r\nimport { mergeStyleStates, applyStyle } from './styler'\r\nimport { ChalkeeBase } from './ChalkeeBase'\r\n\r\n// Property descriptors cache to avoid recreating them\r\nconst propertyDescriptorCache: Record<string, PropertyDescriptor> = {}\r\n\r\nfunction getCachedPropertyDescriptor(key: string, getter: () => PropertyDescriptor): PropertyDescriptor {\r\n    if (!propertyDescriptorCache[key]) {\r\n        propertyDescriptorCache[key] = getter()\r\n    }\r\n    return propertyDescriptorCache[key]\r\n}\r\n\r\n// Create color descriptor once and reuse\r\nconst createColorDescriptor = getCachedPropertyDescriptor('createColor', () => ({\r\n    value: function createColor(this: ChalkeeBase, colorName: string, text?: string): ChalkeeBase {\r\n        const currentState = this._state || createStyleState()\r\n        const isInBgMode = !!this._isInBgMode\r\n\r\n        if (isInBgMode) {\r\n            const bgColorName = `bg${colorName.charAt(0).toUpperCase()}${colorName.slice(1)}`\r\n            const colorDef = getColor(bgColorName)\r\n            if (colorDef) {\r\n                const newState = {\r\n                    ...currentState,\r\n                    backgroundColors: [colorDef],\r\n                    isOpen: true,\r\n                    autoSpacing: currentState.autoSpacing || false\r\n                }\r\n\r\n                if (text !== undefined) {\r\n                    const newInstance = new (this.constructor as any)(newState, '')\r\n                    const styledText = applyStyle(text, newState)\r\n                    newInstance._accumulatedText = (this as any)._accumulatedText + styledText;\r\n                    (newInstance as any)._isInBgMode = true\r\n                    return newInstance as any as ChalkeeBase\r\n                } else {\r\n                    const newInstance: ChalkeeBase = new (this.constructor as any)(newState, '')\r\n                    newInstance._accumulatedText = this._accumulatedText\r\n                    newInstance._isInBgMode = true\r\n                    return newInstance\r\n                }\r\n            }\r\n        }\r\n\r\n        const newState = mergeStyleStates(currentState, {\r\n            ...createStyleState(),\r\n            colors: [getColor(colorName)!],\r\n            isOpen: true,\r\n            autoSpacing: currentState.autoSpacing || false\r\n        })\r\n\r\n        if (text !== undefined) {\r\n            const newInstance: ChalkeeBase = new (this.constructor as any)(newState, '')\r\n            const styledText = applyStyle(text, newState)\r\n            newInstance._accumulatedText = this._accumulatedText + styledText\r\n            return newInstance\r\n        } else {\r\n            const newInstance: ChalkeeBase = new (this.constructor as any)(newState, '')\r\n            newInstance._accumulatedText = this._accumulatedText\r\n            return newInstance\r\n        }\r\n    },\r\n    writable: true,\r\n    enumerable: false,\r\n    configurable: true\r\n}))\r\n\r\nObject.defineProperty(ChalkeeBase.prototype, 'createColor', createColorDescriptor)\r\n\r\nconst createModifierDescriptor = getCachedPropertyDescriptor('createModifier', () => ({\r\n    value: function createModifier(this: ChalkeeBase, modifier: string): ChalkeeBase {\r\n        const currentState = this._state || createStyleState()\r\n        const newState = mergeStyleStates(currentState, {\r\n            ...createStyleState(),\r\n            modifiers: [...(currentState.modifiers || []), modifier],\r\n            isOpen: true,\r\n            autoSpacing: currentState.autoSpacing || false\r\n        })\r\n        const newInstance = new (this.constructor as any)(newState, '')\r\n        newInstance._accumulatedText = (this as any)._accumulatedText\r\n        return newInstance as any as ChalkeeBase\r\n    },\r\n    writable: true,\r\n    enumerable: false,\r\n    configurable: true\r\n}))\r\n\r\nObject.defineProperty(ChalkeeBase.prototype, 'createModifier', createModifierDescriptor)\r\n\r\ndeclare module './ChalkeeBase' {\r\n    interface ChalkeeBase {\r\n        createColor(colorName: string, text?: string): ChalkeeBase\r\n        createModifier(modifier: string): ChalkeeBase\r\n        createBgMode(): ChalkeeBase\r\n    }\r\n}"],"names":["propertyDescriptorCache","getCachedPropertyDescriptor","key","getter","createColorDescriptor","colorName","text","currentState","createStyleState","bgColorName","colorDef","getColor","newState","newInstance","styledText","applyStyle","mergeStyleStates","ChalkeeBase","createModifierDescriptor","modifier"],"mappings":";;;AAMA,MAAMA,IAA8D,CAAA;AAEpE,SAASC,EAA4BC,GAAaC,GAAsD;AACpG,SAAKH,EAAwBE,CAAG,MAC5BF,EAAwBE,CAAG,IAAIC,EAAA,IAE5BH,EAAwBE,CAAG;AACtC;AAGA,MAAME,IAAwBH,EAA4B,eAAe,OAAO;AAAA,EAC5E,OAAO,SAAwCI,GAAmBC,GAA4B;AAC1F,UAAMC,IAAe,KAAK,UAAUC,EAAA;AAGpC,QAFmB,CAAC,CAAC,KAAK,aAEV;AACZ,YAAMC,IAAc,KAAKJ,EAAU,OAAO,CAAC,EAAE,YAAA,CAAa,GAAGA,EAAU,MAAM,CAAC,CAAC,IACzEK,IAAWC,EAASF,CAAW;AACrC,UAAIC,GAAU;AACV,cAAME,IAAW;AAAA,UACb,GAAGL;AAAA,UACH,kBAAkB,CAACG,CAAQ;AAAA,UAC3B,QAAQ;AAAA,UACR,aAAaH,EAAa,eAAe;AAAA,QAAA;AAG7C,YAAID,MAAS,QAAW;AACpB,gBAAMO,IAAc,IAAK,KAAK,YAAoBD,GAAU,EAAE,GACxDE,IAAaC,EAAWT,GAAMM,CAAQ;AAC5C,iBAAAC,EAAY,mBAAoB,KAAa,mBAAmBC,GAC/DD,EAAoB,cAAc,IAC5BA;AAAA,QACX,OAAO;AACH,gBAAMA,IAA2B,IAAK,KAAK,YAAoBD,GAAU,EAAE;AAC3E,iBAAAC,EAAY,mBAAmB,KAAK,kBACpCA,EAAY,cAAc,IACnBA;AAAA,QACX;AAAA,MACJ;AAAA,IACJ;AAEA,UAAMD,IAAWI,EAAiBT,GAAc;AAAA,MAC5C,GAAGC,EAAA;AAAA,MACH,QAAQ,CAACG,EAASN,CAAS,CAAE;AAAA,MAC7B,QAAQ;AAAA,MACR,aAAaE,EAAa,eAAe;AAAA,IAAA,CAC5C;AAED,QAAID,MAAS,QAAW;AACpB,YAAMO,IAA2B,IAAK,KAAK,YAAoBD,GAAU,EAAE,GACrEE,IAAaC,EAAWT,GAAMM,CAAQ;AAC5C,aAAAC,EAAY,mBAAmB,KAAK,mBAAmBC,GAChDD;AAAA,IACX,OAAO;AACH,YAAMA,IAA2B,IAAK,KAAK,YAAoBD,GAAU,EAAE;AAC3E,aAAAC,EAAY,mBAAmB,KAAK,kBAC7BA;AAAA,IACX;AAAA,EACJ;AAAA,EACA,UAAU;AAAA,EACV,YAAY;AAAA,EACZ,cAAc;AAClB,EAAE;AAEF,OAAO,eAAeI,EAAY,WAAW,eAAeb,CAAqB;AAEjF,MAAMc,IAA2BjB,EAA4B,kBAAkB,OAAO;AAAA,EAClF,OAAO,SAA2CkB,GAA+B;AAC7E,UAAMZ,IAAe,KAAK,UAAUC,EAAA,GAC9BI,IAAWI,EAAiBT,GAAc;AAAA,MAC5C,GAAGC,EAAA;AAAA,MACH,WAAW,CAAC,GAAID,EAAa,aAAa,CAAA,GAAKY,CAAQ;AAAA,MACvD,QAAQ;AAAA,MACR,aAAaZ,EAAa,eAAe;AAAA,IAAA,CAC5C,GACKM,IAAc,IAAK,KAAK,YAAoBD,GAAU,EAAE;AAC9D,WAAAC,EAAY,mBAAoB,KAAa,kBACtCA;AAAA,EACX;AAAA,EACA,UAAU;AAAA,EACV,YAAY;AAAA,EACZ,cAAc;AAClB,EAAE;AAEF,OAAO,eAAeI,EAAY,WAAW,kBAAkBC,CAAwB;"}